<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="robots" content="noindex, nofollow">
  <title>Mental Health Questionnaire (Multiple Feelings, Email Results)</title>
  <style>
    /* ----------------------------------
       Basic DARK THEME styling
    -------------------------------------*/
    html, body {
      margin: 0; 
      padding: 0;
      background: #121212;
      color: #ffffff;
      font-family: Arial, sans-serif;
      scroll-behavior: smooth;
    }
    a, button { cursor: pointer; }
    h1, h2, h3, h4 { margin: 0; }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }
    .card {
      background: #1f1f1f;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .brief {
      min-height: 50px;
    }
    .card h2 {
      margin-bottom: 0.5rem;
    }
    .offset-margin {
        margin-bottom: -15px;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
      padding-bottom: 5px;
      color: #bdbdbd;
    }

    #chosenDistortions {
      margin-bottom: 15px;
    }

    h3 {
      margin-bottom: 5px !important;
    }

    .distortion-desc {
      margin-top: 0;
    }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.8rem;
      border: 1px solid #333;
      border-radius: 4px;
      background: #2a2a2a;
      color: #ffffff;
    }
    textarea {
        resize: vertical;
        min-height: 250px;
    }
 
    button {
      background: #4CAF50;
      color: #ffffff;
      border: none;
      padding: 0.7rem 1rem;
      border-radius: 4px;
      margin-right: 0.5rem;
      margin-top: 0.5rem;
      font-size: 1rem;
    }
    button:hover {
      background: white;
    }
    hr { margin: 2rem 0; border-color: #333; }

    /* Big instructions toggle */
    .instructions-toggle, .send-email {
      background: #5ef939;
      margin-bottom: 1rem;
      color: black;
      font-weight: bold;
    }
    .instructions-toggle {
        margin: 0 auto;
        width: 100%;
    }
    h1 {
        text-align: center;
    }
    .instructions-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-out;
      border-left: 4px solid #5ef939;
      margin-bottom: 1rem;
      padding-left: 1rem;
    }
    .instructions-content.open {
      max-height: 5000px; /* big enough to show all text */
      transition: max-height 1s ease-in;
    }

    .thought-textarea, .evidence-textarea {
      display: block;
      width: 100%;
      /* Start small, will auto-grow as user types */
      min-height: 40px;

      background: #2a2a2a;
      color: #ffffff;
      border: 1px solid #333;
      border-radius: 4px;
      margin-bottom: 0.8rem;
      padding: 0.5rem;

      /* Turn off manual drag‚Äêresizing and scrollbars,
        because we‚Äôre auto‚Äêresizing in JS */
      resize: none;
      overflow: hidden;
    }

    *,
*::before,
*::after {
  box-sizing: border-box;
}

    /* 1) In your HTML <head>:
-----------------------------------------------
<link rel="stylesheet" 
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap">
-----------------------------------------------

2) Then, in your CSS file or <style> block:
-----------------------------------------------
*/

/* Apply Nunito across the entire site */

/* Ensure form elements inherit the same font */
input, textarea, select, button {
  font-family: 'Nunito', sans-serif;
  font-size: 1rem;
  color: #fff;
  background: #2a2a2a; /* or your chosen color */
  border: 1px solid #333;
  border-radius: 4px;
  padding: 0.5rem;
  margin-bottom: 0.8rem;
}

/* Example heading style */
h1, h2, h3, h4 {
  margin: 0;
  font-family: 'Nunito', sans-serif;
  font-weight: 700; /* or 400, 600, etc. */
}

h2 {
  color: #5ef939;

}


    /* Modal for Problematic Styles */
    .modal {
      display: none; 
      position: fixed; 
      z-index: 9999; 
      left: 0; 
      top: 0;
      width: 100%; 
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
      background-color: #1f1f1f;
      margin: 5% auto;
      padding: 1rem;
      border-radius: 8px;
      width: 90%;
      max-width: 700px;
      position: relative;
    }
    .close {
      position: absolute;
      top: 15px; 
      right: 15px;
      color: #aaa; 
      font-size: 28px; 
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: #fff;
    }
    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 0.5rem;
    }
    .distortion-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 1rem;
    }
    .distortion-grid label {
      background: #2a2a2a;
      border-radius: 4px;
      padding: 0.5rem;
      display: block;
      cursor: pointer;
    }
    .distortion-grid input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    /* On mobile, 1 column layout */
    @media(max-width: 600px) {
      .distortion-grid {
        grid-template-columns: 1fr;
      }
    }


    /* Accordion toggles for step guidance/examples */
    .accordion-toggle {
      background: #333;
      margin-bottom: 0.5rem;
      border: none;
      border-radius: 4px;
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
      display: inline-block;
    }
    .accordion-toggle:hover { background: #444; }
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-out;
      border-left: 4px solid #444;
      margin-bottom: 1rem;
      padding-left: 1rem;
    }
    .accordion-content.open {
      max-height: 1000px; /* enough to show text */
      transition: max-height 1s ease-in;
    }

    /* Feeling wheel */
    .wheel-container {
      text-align: center;
      margin-bottom: 1rem;
    }
    .wheel-container img {
      max-width: 100%;
      height: auto;
      cursor: zoom-in;
    }
    .zoomed-in {
      cursor: zoom-out;
      max-width: 300%;
    }

    .distortion-icon {
    font-size: 1.5rem;      /* tweak size as needed */
    color: #5ef939;
    margin-bottom: 0.3rem; 
    display: inline-block;  /* ensures the icon sits on its own line if desired */
  }

  /* The rest can remain the same as your existing distortion-grid styling */
  .distortion-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 1rem;
  }
  
  .distortion-grid label {
    background: #2a2a2a;
    border-radius: 4px;
    padding: 0.5rem;
    display: block;
    cursor: pointer;
  }
  .distortion-grid input[type="checkbox"] {
    margin-right: 0.5rem;
  }
  @media(max-width: 600px) {
    .distortion-grid {
      grid-template-columns: 1fr;
    }
  }

  .evidence-row {
    display: flex; 
    flex-wrap: wrap; 
    margin-bottom: 1rem;
  }
  .evidence-text {
    flex: 1;
    margin-right: 0.5rem;
  }
  .evidence-rating {
    width: 70px;
  }
  /* On smaller screens, stack them */
  @media (max-width: 600px) {
    .evidence-row {
      flex-direction: column;
    }
    .evidence-text {
      margin-right: 0; 
      margin-bottom: 0.5rem;
    }
  }

  /* Optionally tweak the paragraph style under each title: */
  .distortion-desc {
    margin: 0.25rem 0 0;
  }

    /* Hiding optional feelings initially */
    .hidden { display: none; }


  /* Each "thought row" with text & rating side by side */
  .thought-row {
    display: flex; 
    flex-wrap: wrap; 
    margin-bottom: 1rem;
  }

  /* Let the text field take the remaining space */
  .thought-text {
    flex: 1;
    margin-right: 0.5rem;
  }

  /* The rating field can be narrower */
  .thought-rating {
    width: 70px;
  }

  /* On smaller screens, stack them */
  @media (max-width: 600px) {
    .thought-row {
      flex-direction: column;
    }
    .thought-text {
      margin-right: 0; 
      margin-bottom: 0.5rem;
    }
  }
</style>

  </style>
</head>
<body>
<div class="container">
  <h1>COGNITIVE RESTRUCTURING</h1>
  <br>
  <!-- <p>Fill out each step below. For Step 2, you can add up to three different feelings. When done, type in your email address and click ‚ÄúSend Email‚Äù to open your mail client with your answers pre‚Äêfilled.</p> -->

  <!-- Big instructions block (collapsible) -->
  <button class="instructions-toggle" onclick="toggleInstructions()">
    Show/Hide Full Instructions
  </button>
  <div id="instructionsContent" class="instructions-content">
    <!-- 
      IMPORTANT: Insert your entire text verbatim here. 
      For brevity, I'm inserting a placeholder below.
      Replace EVERYTHING with your full instructions text so that 
      NO text is omitted.
    -->
    <p>
 <!--
        The user wants 100% of the text included verbatim. 
        We‚Äôll store it in one big block. 
        DO NOT OMIT ANY TEXT:
      -->
      <p>
        The 5 Steps of Cognitive Restructuring (CR) is a skill for carefully examining your
        thinking when you are feeling upset or distressed about something. You can use it to deal
        with any situation in which you are experiencing negative feelings. If a close evaluation
        of your distressing thought indicates that it is not accurate, you will change it to a more
        accurate and less distressing thought. If your evaluation indicates that your distressing
        thought is accurate, then you will come up with an Action Plan to deal with the situation.
        This handout provides instructions for each of the 5 Steps of CR. Handout 28 provides a
        worksheet for using the 5 Steps of CR to address an upsetting feeling in a specific
        situation.
      </p>
      <p><strong>STEP 1: THE SITUATION</strong><br/>
        In Step 1, you write down the upsetting situation. The situation might be an actual event,
        such as going to the grocery store, or having an argument with someone, or a memory of
        an event such as thinking about the disaster. In either case, just write one sentence
        describing the situation.
      </p>
      <p><strong>STEP 2: THE FEELING</strong><br/>
        In Step 2, you want to identify the most upsetting feeling you had in the situation.
        Sometimes you may have had more than one feeling in the situation, but you should
        focus on identifying the strongest and most upsetting feeling. It is easiest to focus on
        four broad feelings:
        <ul>
          <li>fear and anxiety</li>
          <li>sadness and depression</li>
          <li>guilt and shame</li>
          <li>anger</li>
        </ul>
        Pick one of these four feelings and work through all 5 steps with this feeling. For
        example, fear might be the strongest feeling associated with going to the grocery store,
        while guilt might be the strongest feeling associated with the thought of not evacuating
        from the flood soon enough.<br/>
        If you have more than one strong feeling about a given situation, complete a CR on the
        first feeling and then a second CR on the next feeling.
      </p>
      <p><strong>STEP 3: THE THOUGHT</strong><br/>
        In Step 3, you identify your thoughts about the situation that are underlying your
        upsetting feelings. If you are unsure what those thoughts are, ask yourself the following
        questions, depending on what your upsetting feelings were:
      </p>
      <ul>
        <li>For fear or anxiety, ask yourself, ‚ÄúWhat bad thing do I expect to happen?‚Äù ‚ÄúWhat kind of danger am I in?‚Äù</li>
        <li>For sadness or depression, ask yourself, ‚ÄúWhat have I lost hope in?‚Äù ‚ÄúWhat is missing in my life or in me?‚Äù</li>
        <li>For guilt or shame, ask yourself, ‚ÄúWhat bad thing have I done?‚Äù ‚ÄúWhat is wrong with me?‚Äù</li>
        <li>For anger, ask yourself, ‚ÄúWhat is unfair about this situation?‚Äù ‚ÄúWho has wronged me?‚Äù</li>
      </ul>
      <p>
        These questions can help you identify the thoughts that are upsetting you. For example,
        anxiety about going to the grocery store might be related to the thought ‚ÄúI won‚Äôt be able
        to get out if someone starts shooting;‚Äù feeling guilty about not evacuating soon enough
        might be related to the thought ‚ÄúIf I had evacuated sooner, I would have saved my
        father‚Äôs life.‚Äù
      </p>
      <p>
        Try to be as specific as possible when identifying upsetting thoughts. For example, the
        thought ‚ÄúThere could be a shooter in the grocery store and I wouldn‚Äôt be able to get out
        alive‚Äù is more specific than the thought ‚ÄúSomething bad might happen in the grocery
        store.‚Äù Similarly, the thought ‚ÄúIf I had evacuated sooner, I would have been able to save
        my father‚Äôs life‚Äù is more specific than the thought ‚ÄúI am a bad person.‚Äù
      </p>
      <p>
        You may have several upsetting thoughts related to the situation. The following questions
        may help you identify other upsetting thoughts about the situation:
        <ul>
          <li>What would it mean to you if XX happened?</li>
          <li>If XX happened, what would happen then?</li>
          <li>What would be so bad about XX happening?</li>
        </ul>
        Write down all the upsetting thoughts about the situation on the worksheet that you can
        think of. When you are done, go through each thought and choose the one that is most
        upsetting or distressing to you. Circle the thought on the worksheet‚Äîthat is the thought
        you will be working on for the remaining steps.
      </p>
      <p>
        After identifying your most upsetting thought, consider whether it might be one of the
        Problematic Thinking Styles listed on the worksheet. That is, ask yourself whether your
        thought might be a common but inaccurate way of reaching conclusions in a situation.
        For example, the thought ‚ÄúThere could be a shooter in the grocery store and I wouldn‚Äôt be
        able to get out alive‚Äù might be an example of the Overestimating Risk thinking style. If
        you think your thought may be one (or more) of the Problematic Thinking Styles listed,
        circle which ones on the worksheet. If not or you are unsure, you don‚Äôt have to circle any
        of them.
      </p>
      <p><strong>STEP 4: EVALUATE THE THOUGHT</strong><br/>
        In Step 4 you want to evaluate the accuracy of your upsetting thought as carefully and
        objectively as possible. To do this, first think of all of the evidence you can that supports
        your thought or makes you think it is accurate. For example, for the thought ‚ÄúThere could
        be a shooter in the grocery store and I wouldn‚Äôt be able to get out alive‚Äù the person could
        ask, ‚ÄúWhy do I think there will be a shooter in the grocery store?‚Äù and ‚ÄúIf there was a
        shooter there, why do I think I wouldn‚Äôt be able to get out alive?‚Äù Write all the evidence
        down on the worksheet.
      </p>
      <p>
        Then, think of all the evidence you can that does not support your thought, or suggests it
        may not be accurate. Consider as many reasons as you can for why your thought might
        not be correct. Then, write all the evidence against the thought down on the worksheet.
      </p>
      <p>
        One way of helping you come up with evidence against the thought is to go back to Step
        3 and examine whether you decided that the thought might be a Problematic Thinking
        Style. If you did, and you circled one or more of the specific Problematic Thinking
        Styles, then it means that you believe the thought may be inaccurate, and you can ask
        yourself why you believed that. For example, if the person identifying the thought in Step
        3 about the shooter (‚ÄúThere could be a shooter in the grocery store and I wouldn‚Äôt be able
        to get out alive‚Äù) indicated that it was an example of the Overestimating Risk thinking
        style, they could ask themselves ‚ÄúDoes thinking that a shooter could be in the grocery
        store overestimate the real chances of such a thing occurring?‚Äù and ‚ÄúRealistically, what
        are the chances that a shooter will show up at the grocery store when I go shopping?‚Äù
        Answers to these questions are evidence against the thought being accurate, and should
        be recorded.
      </p>
      <p>
        Another way of identifying evidence that does not support the thought is to ask yourself
        questions that may help you look at the situation and your thought differently. Some good
        questions to ask are:
        <ol>
          <li>Is there another way of looking at the situation?</li>
          <li>Is there an alternative explanation for what happened?</li>
          <li>How would someone else think about the situation?</li>
          <li>Is my concern based more on how I feel than the actual facts in the situation?</li>
          <li>Am I placing unrealistic and unobtainable standards on myself that I would never
          expect other people to achieve?</li>
          <li>Am I overestimating how much control and responsibility I have in this
          situation?</li>
          <li>What would be the worst thing that could happen if my fear were true?</li>
          <li>Am I not considering everything I can do to deal with the problem or situation?</li>
          <li>Am I thinking that because a low-probability event happened to me, that it is
          very likely to happen again to me?</li>
        </ol>
      </p>
      <p>
        As an example of coming up with all the evidence for and against a thought, the person
        evaluating the thought ‚ÄúThere could be a shooter in the grocery store and I wouldn‚Äôt be
        able to get out alive‚Äù might list the following evidence supporting the accuracy of the
        thought:
        <ul>
          <li>Shootings can happen in public places.</li>
          <li>I was afraid.</li>
          <li>There was a man wearing a backpack in the store which could have had a weapon.</li>
          <li>If a shooting happened it would be hard to get to the exit without drawing attention
          to myself.</li>
        </ul>
      </p>
      <p>
        The person might then list the following evidence against the thought:
        <ul>
          <li>I have been to the grocery store many times and nothing bad has happened.</li>
          <li>I feel afraid in a lot of situations where nothing bad happens.</li>
          <li>Carrying a backpack doesn‚Äôt mean the man had a gun.</li>
          <li>Mass shootings in public places like grocery stores occur very rarely, and such an
          event is very unlikely to happen.</li>
        </ul>
      </p>
      <p><strong>STEP 5: MAKE A DECISION</strong><br/>
        Step 5 involves making a decision about whether your thought is accurate or not, based
        on all the evidence you have listed in Step 4, and then taking action based on your
        decision. When considering the evidence for and against the accuracy of your thought,
        you should place the greatest weight on strong evidence that is objective and based on
        facts, and give less attention to weak evidence that is based only on feelings or beliefs.
        Being objective when evaluating your thought is important, since you want your
        understanding of the situation to be as accurate as possible so that any actions you take
        are informed and effective.
      </p>
      <p>
        When trying to be objective, you can think of yourself like a scientist who is evaluating
        the evidence supporting the effectiveness of a new treatment and is primarily interested in
        objective facts. Or you can think of yourself like a lawyer, presenting the evidence for or
        against a case to an impartial jury, based on the facts. You can also ask yourself whether
        you could convince another person that the thought is true (or false).
      </p>
      <p>
        For example, after weighing the evidence for and against the thought that the person
        might encounter a shooter at the grocery store (‚ÄúThere could be a shooter in the grocery
        store and I wouldn‚Äôt be able to get out alive‚Äù), the person decided that the thought was
        not supported by the evidence and was inaccurate. The strongest pieces of evidence
        against the thought were the fact that the person had been to the grocery store many times
        before and nothing happened, lots of people wear backpacks that don‚Äôt carry guns, and
        mass shootings in public places are very rare.
      </p>
      <p>
        After deciding whether the thought is accurate or not (and checking the designated box
        on the worksheet), you then take action, depending on your decision. If you concluded
        that the evidence does not support the thought, then you come up with a new and more
        accurate thought to replace your old inaccurate thought. This new thought is recorded on
        the worksheet. New and more accurate thoughts are almost always associated with a
        reduction in distress compared to the original, inaccurate thought.
      </p>
      <p>
        For example, the person who concluded that their thought about encountering a shooter at
        the grocery store was inaccurate came up with the following more accurate thought:
        ‚ÄúEven though I feel anxious when I go to the grocery store, it is very unlikely that there
        will be a shooting. It is safe for me to shop there.‚Äù This new thought was written down on
        the worksheet
      </p>
      <p>
        On the other hand, if you concluded that the evidence does support the thought, and
        therefore that the thought is accurate, it means that you have a good reason for feeling
        upset about the situation. In this case, taking action involves developing an Action Plan
        for dealing with the upsetting situation, and changing it somehow. An Action Plan can be
        developed with the help of a separate worksheet (see Handout 29), which breaks the
        planning down into four steps: 1) define the problem, 2) brainstorm possible solutions
        and select the best one(s), 3) make a plan to implement the selected solution(s), 4) follow
        the plan and set a time to follow up on whether it was implemented successfully.
      </p>
      <p>
        In some situations, you might first go through the 5 Steps of CR and conclude that an upsetting
        thought was inaccurate, and then come up with a new and more accurate thought which is less
        upsetting, but which is nevertheless still somewhat distressing. In this case, you can then develop
        an Action Plan to deal with the distressing situation. Thus, in some situations you may need to
        both correct inaccurate thinking to make it more accurate and create an Action Plan to address a
        genuine problem.
      </p>
    </p>
  </div>

  <hr/>

  <!-- Feeling Wheel -->
  <!-- <div class="wheel-container">
    <img 
      id="feelingWheelImage" 
      src="./wheel.jpeg"
      alt="Feeling Wheel"
      title="Tap/Click to Zoom"
    />
  </div> -->

  <!-- STEP 1: SITUATION -->
  <div class="card">
    <h2>Step 1: The Situation</h2>
    <button class="accordion-toggle" onclick="toggleAccordion('step1Accordion')">Show/Hide Step 1 Guidance</button>
    <div id="step1Accordion" class="accordion-content">
      <p><strong>Guidance:</strong> In Step 1, write down the upsetting situation. Examples:</p>
      <ul>
        <li>‚ÄúGoing to the grocery store‚Äù</li>
        <li>‚ÄúArgument with a friend‚Äù</li>
        <li>‚ÄúMemory about a past disaster‚Äù</li>
      </ul>
      <p>Keep it short, e.g., one sentence describing the event or memory.</p>
    </div>

    <label for="situationInput">Briefly describe the upsetting situation:</label>
    <textarea class="brief" id="situationInput" rows="3"></textarea>
  </div>

  <!-- STEP 2: THE FEELINGS (UP TO 3) -->
  <div class="card">
    <h2>Step 2: The Feeling(s)</h2>
    <button class="accordion-toggle" onclick="toggleAccordion('step2Accordion')">Show/Hide Step 2 Guidance</button>
    <div id="step2Accordion" class="accordion-content">
      <p><strong>Guidance:</strong> Identify the most upsetting feeling(s). Typically:
      <ul>
        <li>Fear / Anxiety</li>
        <li>Sadness / Depression</li>
        <li>Guilt / Shame</li>
        <li>Anger</li>
      </ul>
      You can add up to 3 different feelings if multiple feelings were strong.
      </p>
    </div>

    <!-- FEELING BLOCK 1 -->
    <div id="feelingBlock1">
      <label for="feelingSelect1">Broad Feeling #1:</label>
      <select id="feelingSelect1">
        <option value="" disabled selected>Select one...</option>
        <option value="fearAnxiety">Fear / Anxiety</option>
        <option value="sadnessDepression">Sadness / Depression</option>
        <option value="guiltShame">Guilt / Shame</option>
        <option value="anger">Anger</option>
      </select>

      <label for="subFeelingSelect1">Sub-Feeling #1 (optional):</label>
      <select id="subFeelingSelect1" disabled>
        <option value="" disabled selected>Select...</option>
      </select>

      <label for="priorityScale1">Priority (1-10):</label>
      <input 
        type="number" 
        id="priorityScale1" 
        min="1" 
        max="10" 
        step="1" 
        value="" 
        oninput="highlightHighestPriority()"
      />
    </div>

    <!-- Button to reveal block 2 -->
    <button id="showBlock2Btn" class="send-email" onclick="showFeelingBlock(2)">Add Another Feeling</button>

    <!-- FEELING BLOCK 2 (hidden by default) -->
    <div id="feelingBlock2" class="hidden">
      <label for="feelingSelect2">Broad Feeling #2:</label>
      <select id="feelingSelect2">
        <option value="" disabled selected>Select one...</option>
        <option value="fearAnxiety">Fear / Anxiety</option>
        <option value="sadnessDepression">Sadness / Depression</option>
        <option value="guiltShame">Guilt / Shame</option>
        <option value="anger">Anger</option>
      </select>

      <label for="subFeelingSelect2">Sub-Feeling #2 (optional):</label>
      <select id="subFeelingSelect2" disabled>
        <option value="" disabled selected>Select...</option>
      </select>

      <label for="priorityScale2">Priority (1-10):</label>
      <input 
        type="number" 
        id="priorityScale2" 
        min="1" 
        max="10" 
        step="1" 
        value="" 
        oninput="highlightHighestPriority()"
      />
      <br>
      <button id="showBlock3Btn"  class="send-email" onclick="showFeelingBlock(3)">Add Another Feeling</button>
    </div>

    <!-- FEELING BLOCK 3 (hidden by default) -->
    <div id="feelingBlock3" class="hidden">
      <label for="feelingSelect3">Broad Feeling #3:</label>
      <select id="feelingSelect3">
        <option value="" disabled selected>Select one...</option>
        <option value="fearAnxiety">Fear / Anxiety</option>
        <option value="sadnessDepression">Sadness / Depression</option>
        <option value="guiltShame">Guilt / Shame</option>
        <option value="anger">Anger</option>
      </select>

      <label for="subFeelingSelect3">Sub-Feeling #3 (optional):</label>
      <select id="subFeelingSelect3" disabled>
        <option value="" disabled selected>Select...</option>
      </select>

      <label for="priorityScale3">Priority (1-10):</label>
      <input 
        type="number"
        id="priorityScale3" 
        min="1" 
        max="10" 
        step="1" 
        value=""
        oninput="highlightHighestPriority()"
      />
      
    </div>
  </div>

  <!-- STEP 3: THE THOUGHT -->
  <div class="card">
    <h2>Step 3: The Thought</h2>
    <button class="accordion-toggle" onclick="toggleAccordion('step3Accordion')">Show/Hide Step 3 Examples / Guidance</button>
    <div id="step3Accordion" class="accordion-content">
      <p><strong>Guidance Questions:</strong>
      <ul>
        <li><em>Fear/Anxiety:</em> ‚ÄúWhat bad thing do I expect to happen?‚Äù ‚ÄúWhat danger am I in?‚Äù</li>
        <li><em>Sadness/Depression:</em> ‚ÄúWhat have I lost hope in?‚Äù ‚ÄúWhat is missing in my life?‚Äù</li>
        <li><em>Guilt/Shame:</em> ‚ÄúWhat bad thing have I done?‚Äù ‚ÄúWhat is wrong with me?‚Äù</li>
        <li><em>Anger:</em> ‚ÄúWhat is unfair about this situation?‚Äù ‚ÄúWho has wronged me?‚Äù</li>
      </ul>
      <p>You can also ask:
        <ul>
          <li>‚ÄúWhat would it mean to you if XX happened?‚Äù</li>
          <li>‚ÄúIf XX happened, what would happen then?‚Äù</li>
          <li>‚ÄúWhat would be so bad about XX happening?‚Äù</li>
        </ul>
      </p>
      <p><strong>Example Thought:</strong> ‚ÄúIf I go to the grocery store, there could be a shooter and I wouldn't be able to get out alive.‚Äù</p>
      </p>
    </div>
    <label for="thoughtInput">
      What thought(s) underlie your feeling? (Focus on the most upsetting one.)
    </label>
    <label><strong>STEP 1:</strong> Enter each thought and give it a Distress Rating (1‚Äì10). The highest rating is highlighted in red.</label>
    <label><strong>STEP 2:</strong> Once the most distressing thought is identified, apply a problematic style of thinking, or more than one if you can.</label>

    <!-- Container where new thought rows will be appended -->
    <div id="thoughtContainer"></div>
  
    <!-- Button to add new thought row -->
    <button class="send-email" onclick="addThoughtRow()">+ Add Another Thought</button>
    <!-- NEW BUTTON for Distortions (Popup) -->
    <button class="send-email" style="margin-top:-5px" onclick="openDistortionsModal()">
      Problematic Styles of Thinking
    </button> <span>(Highlighted Thought)</span>

    <br>
    <!-- NEW: Where selected distortions will appear -->
    <div id="chosenDistortions" style="margin:0rem 0 15px; color: #5ef939; font-weight: bold;"></div>

  </div>

  <!-- STEP 4: EVALUATE THE THOUGHT -->
  <div class="card">
    <h2>Step 4: Evaluate the Thought</h2>
    <button class="accordion-toggle" onclick="toggleAccordion('step4Accordion')">Show/Hide Step 4 Guidance</button>
    <div id="step4Accordion" class="accordion-content">
        <p><strong>Guidance:</strong> List the evidence FOR and AGAINST your thought.
            <ul>
              <li>Ask: ‚ÄúIs there another way of looking at this situation?‚Äù</li>
              <li>‚ÄúAm I overestimating the risk or how much responsibility I have?‚Äù</li>
              <li>‚ÄúWhat would someone else say about this situation?‚Äù</li>
            </ul>
            <p><strong>Example (Shooter in Grocery Store):</strong><br/>
            <em>Evidence FOR:</em>
            <ul>
              <li>‚ÄúShootings can happen in public places.‚Äù</li>
              <li>‚ÄúI was afraid.‚Äù</li>
              <li>‚ÄúA man wore a backpack; maybe it had a weapon.‚Äù</li>
              <li>‚ÄúIt might be hard to escape without drawing attention.‚Äù</li>
            </ul>
            <em>Evidence AGAINST:</em>
            <ul>
              <li>‚ÄúI've been to the store many times; nothing bad happened.‚Äù</li>
              <li>‚ÄúFeeling afraid doesn't mean it‚Äôs actually dangerous.‚Äù</li>
              <li>‚ÄúA backpack doesn‚Äôt necessarily contain a gun.‚Äù</li>
              <li>‚ÄúMass shootings are relatively rare events.‚Äù</li>
            </ul>
            </p>
    </div>

    <!-- <label for="evidenceFor">Evidence FOR this thought:</label>
    <textarea id="evidenceFor" rows="3"></textarea>



    <label for="evidenceAgainst">Evidence AGAINST this thought:</label>
    <textarea id="evidenceAgainst" rows="3"></textarea> -->

    <h3>Evidence FOR this thought</h3>
    <div id="evidenceForContainer"></div>
    <button class="send-email" onclick="addEvidenceForRow()">+ Add Evidence FOR</button>

    <hr/>

    <!-- EVIDENCE AGAINST BLOCK -->
    <h3>Evidence AGAINST this thought</h3>
    <button class="accordion-toggle" onclick="toggleAccordion('step6Accordion')">More ways to think about the thought</button>
    <div id="distortionMessage" style="
      color: #5ef939; 
      font-weight: bold; 
      margin: 0.5rem 0;
    "></div>
    <div id="step6Accordion" class="accordion-content">
            <ul>
              <li>Is there another way of looking at the situation?‚Äù</li>
              <li>Is there an alternative explanation for what happened?</li>
              <li>How would someone else think about the situation?</li>
              <li>Is my concern based more on how I feel than the actual facts in the situation?</li>
              <li>Am I placing unrealistic and unobtainable standards on myself that I would never expect other people to achieve?</li>
              <li>Am I overestimating how much control and responsibility I have in this situation?</li>
              <li>What would be the worst thing that could happen if my fear were true?</li>
              <li>Am I not considering everything I can do to deal with the problem or situation?</li>
              <li>Am I thinking that because a low-probability event happened to me, that it is very likely to happen again to me?</li>
            </ul>
    </div>
    <div id="evidenceAgainstContainer"></div>
    <button class="send-email" onclick="addEvidenceAgainstRow()">+ Add Evidence AGAINST</button>
  </div>

  <!-- STEP 5: MAKE A DECISION -->
  <div class="card">
    <h2>Step 5: Make a Decision</h2>
    <button class="accordion-toggle" onclick="toggleAccordion('step5Accordion')">Show/Hide Step 5 Guidance</button>
    <div id="step5Accordion" class="accordion-content">
        <p><strong>Guidance:</strong>
            <ul>
              <li>Weigh the evidence carefully. If the thought is inaccurate, form a new, more accurate thought.</li>
              <li>If the thought is accurate, outline an Action Plan to deal with the real situation.</li>
              <li>Example (Inaccurate Thought): ‚ÄúEven though I'm anxious, it‚Äôs unlikely there‚Äôll be a shooting. It‚Äôs safe to shop.‚Äù</li>
              <li>Example (Accurate Thought): If it truly is a risky situation, create a plan or problem-solving steps.</li>
            </ul>
            </p>
    </div>

    <p>Is this thought accurate or inaccurate?</p>
    <label class="offset-margin">
      <input type="radio" name="accuracy" value="Accurate" />Accurate</label>
    <label>
      <input type="radio" name="accuracy" value="Inaccurate" />Inaccurate</label>

    <label for="newThought">
      If inaccurate, write a new, more accurate thought.  
      If accurate, outline an action plan to address the situation:
    </label>
    <textarea id="newThought" rows="3"></textarea>
  </div>

  <!-- EMAIL SECTION -->
  <div class="card">
    <h2>Send Results to Your Email</h2>

    <label for="emailTitle">Email Title (Optional):</label>
    <input type="text" id="emailTitle" placeholder="e.g. Grocery Store Anxiety" />

    <label for="userEmail">Your Email Address: </label>
    <input type="text" id="userEmail" placeholder="you@example.com" value="devoncbt@gmail.com" />

    <button class="send-email" id="sendEmailBtn" onclick="sendEmail()">Send Email with Your Results</button>

    <p>(This will open your mail client so you can review and send.)</p>
  </div>


</div><!-- .container -->

<div id="distortionsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeDistortionsModal()">&times;</span>
    <h2>Problematic Styles of Thinking</h2>

    <div class="distortion-grid">
      <label>
        <!-- big green emoji above the title -->
        <div class="distortion-icon">üîç</div>
        <input type="checkbox" value="Magnification/Minimization" />
        <strong>Magnification & Minimization:</strong>
        <p class="distortion-desc">Exaggerating or minimizing importance of events.</p>
      </label>
      
      <label>
        <div class="distortion-icon">üí•</div>
        <input type="checkbox" value="Catastrophizing" />
        <strong>Catastrophizing:</strong>
        <p class="distortion-desc">Seeing only the worst possible outcomes.</p>
      </label>
      
      <label>
        <div class="distortion-icon">üåê</div>
        <input type="checkbox" value="Overgeneralization" />
        <strong>Overgeneralization:</strong>
        <p class="distortion-desc">Broad interpretations from single/few events (‚ÄúI always mess up!‚Äù).</p>
      </label>
      
      <label>
        <div class="distortion-icon">üîÆ</div>
        <input type="checkbox" value="Magical Thinking" />
        <strong>Magical Thinking:</strong>
        <p class="distortion-desc">Belief that thoughts/actions affect unrelated situations.</p>
      </label>
      
      <label>
        <div class="distortion-icon">ü§î</div>
        <input type="checkbox" value="Personalization" />
        <strong>Personalization:</strong>
        <p class="distortion-desc">Believing you are responsible for events outside your control.</p>
      </label>
      
      <label>
        <div class="distortion-icon">ü§∏</div>
        <input type="checkbox" value="Jumping to Conclusions" />
        <strong>Jumping to Conclusions:</strong>
        <p class="distortion-desc">Interpreting situations without enough evidence.</p>
      </label>
      
      <label>
        <div class="distortion-icon">üß†</div>
        <input type="checkbox" value="Mind Reading" />
        <strong>Mind Reading:</strong>
        <p class="distortion-desc">Assuming others‚Äô thoughts/beliefs without evidence.</p>
      </label>
      
      <label>
        <div class="distortion-icon">üî≠</div>
        <input type="checkbox" value="Fortune Telling" />
        <strong>Fortune Telling:</strong>
        <p class="distortion-desc">Expecting a situation will turn out badly without evidence.</p>
      </label>
      
      <label>
        <div class="distortion-icon">‚ù§Ô∏è</div>
        <input type="checkbox" value="Emotional Reasoning" />
        <strong>Emotional Reasoning:</strong>
        <p class="distortion-desc">Assuming emotions reflect reality (‚ÄúI feel bad, so I am bad.‚Äù).</p>
      </label>
      
      <label>
        <div class="distortion-icon">üôÖ</div>
        <input type="checkbox" value="Disqualifying the Positive" />
        <strong>Disqualifying the Positive:</strong>
        <p class="distortion-desc">Ignoring positives, focusing only on negatives.</p>
      </label>
      
      <label>
        <div class="distortion-icon">‚öñÔ∏è</div>
        <input type="checkbox" value="Should Statements" />
        <strong>Should Statements:</strong>
        <p class="distortion-desc">Belief things ‚Äúshould‚Äù be a certain way.</p>
      </label>
      
      <label>
        <div class="distortion-icon">‚ôæÔ∏è</div>
        <input type="checkbox" value="All-or-Nothing Thinking" />
        <strong>All-or-Nothing Thinking:</strong>
        <p class="distortion-desc">Thinking in absolutes (‚Äúalways,‚Äù ‚Äúnever,‚Äù ‚Äúevery‚Äù).</p>
      </label>
    </div>
  </div>
</div>

<script>
  /* --------------------------
     Toggle big instructions
  -------------------------- */
  function toggleInstructions() {
    const content = document.getElementById("instructionsContent");
    content.classList.toggle("open");
  }
  
  /* --------------------------
     Toggle accordions
  -------------------------- */
  function toggleAccordion(id) {
    const el = document.getElementById(id);
    el.classList.toggle("open");
  }
  
  /* --------------------------
     Show/hide additional feeling blocks
  -------------------------- */
  function showFeelingBlock(num) {
    const block = document.getElementById(`feelingBlock${num}`);
    block.classList.remove("hidden");
  
    // Hide the "Add Another Feeling" button once a block is revealed
    if (num === 2) {
      document.getElementById("showBlock2Btn").classList.add("hidden");
    } else if (num === 3) {
      document.getElementById("showBlock3Btn").classList.add("hidden");
    }
  }
  
  /* --------------------------
     Sub-feelings data + select logic
  -------------------------- */
  const subFeelingsMap = {
    fearAnxiety: [
      "Helpless","Frightened","Panic","Hysterical","Inferior","Inadequate",
      "Worried","Anxious","Apprehensive","Nervous","Scared","Terror"
    ],
    sadnessDepression: [
      "Hurt","Depressed","Sorrow","Dismayed","Displeased","Regretful","Isolated",
      "Lonely","Grief","Powerless","Neglected","Despair","Shameful","Disappointed"
    ],
    guiltShame: [
      "Guilty","Ashamed","Remorseful","Embarrassed","Humiliated"
    ],
    anger: [
      "Agitated","Hostile","Hate","Rage","Irritable","Frustrated","Jealous",
      "Contempt","Resentful","Revolted","Aggravated"
    ]
  };
  
  const feelingSelect1 = document.getElementById("feelingSelect1");
  const subFeelingSelect1 = document.getElementById("subFeelingSelect1");
  feelingSelect1.addEventListener("change", () => populateSubFeelings(feelingSelect1, subFeelingSelect1));
  
  const feelingSelect2 = document.getElementById("feelingSelect2");
  const subFeelingSelect2 = document.getElementById("subFeelingSelect2");
  feelingSelect2.addEventListener("change", () => populateSubFeelings(feelingSelect2, subFeelingSelect2));
  
  const feelingSelect3 = document.getElementById("feelingSelect3");
  const subFeelingSelect3 = document.getElementById("subFeelingSelect3");
  feelingSelect3.addEventListener("change", () => populateSubFeelings(feelingSelect3, subFeelingSelect3));
  
  function populateSubFeelings(broadSelect, subSelect) {
    subSelect.innerHTML = '<option value="" disabled selected>Select...</option>';
    const val = broadSelect.value;
    if (subFeelingsMap[val]) {
      subFeelingsMap[val].forEach(sf => {
        const opt = document.createElement("option");
        opt.value = sf;
        opt.textContent = sf;
        subSelect.appendChild(opt);
      });
      subSelect.disabled = false;
    } else {
      subSelect.disabled = true;
    }
  }
  
  /* --------------------------
     Distortions modal
  -------------------------- */
  function openDistortionsModal() {
    document.getElementById("distortionsModal").style.display = "block";
  }
  function closeDistortionsModal() {
    document.getElementById("distortionsModal").style.display = "none";
  }
  
  /* Gather any selected distortions */
  function getSelectedDistortions() {
    const checks = document.querySelectorAll('.distortion-grid input[type="checkbox"]:checked');
    const selected = [];
    checks.forEach(ch => {
      selected.push(ch.value);
    });
    return selected;
  }
  
  /* Show which distortions were selected */
  document.querySelectorAll('.distortion-grid input[type="checkbox"]').forEach(ch => {
    ch.addEventListener('change', updateDistortionsList);
  });
  function updateDistortionsList() {
  const selected = getSelectedDistortions(); // your existing helper
  const container = document.getElementById("chosenDistortions");
  const distortionMsg = document.getElementById("distortionMessage");

  if (selected.length) {
    // For the "selected distortions" line
    container.textContent = "Selected Distortions: " + selected.join(", ");

    // For the special message under "Evidence AGAINST"
    distortionMsg.innerHTML = `
      You chose some distortions:
      <strong>${selected.join(", ")}</strong><br/>
      This means you may already believe the thought to be inaccurate.
      Ask yourself <em>why</em>.
    `;
  } else {
    // Clear both if none selected
    container.textContent = "";
    distortionMsg.innerHTML = "";
  }
}

  /* --------------------------
     Priority highlighting
  -------------------------- */
  function highlightHighestPriority() {
    const blockIds = [1,2,3];
    let maxPriority = 0;
    const blocksData = [];
  
    // Gather each visible block's priority
    blockIds.forEach(num => {
      const block = document.getElementById(`feelingBlock${num}`);
      if (!block.classList.contains("hidden")) {
        const val = parseInt(document.getElementById(`priorityScale${num}`).value) || 0;
        blocksData.push({ block, priority: val });
      }
    });
  
    // Find the max
    if (blocksData.length) {
      maxPriority = Math.max(...blocksData.map(item => item.priority));
    }
  
    // Reset styling, highlight blocks that match the max
    blocksData.forEach(item => {
      item.block.style.border = "none";
      item.block.style.backgroundColor = "";
      if (item.priority === maxPriority && maxPriority > 0) {
        item.block.style.border = "2px solid #5ef939";
        item.block.style.backgroundColor = "#1b3c1b"; 
      }
    });
  }
  
  /* --------------------------
     Thoughts (multiple) logic
  -------------------------- */
  function addThoughtRow() {
  const container = document.getElementById('thoughtContainer');
  const row = document.createElement('div');
  row.className = 'thought-row';

  // Create a TEXTAREA instead of an <input type="text">
  const textArea = document.createElement('textarea');
  textArea.className = 'thought-text thought-textarea';
  textArea.placeholder = 'Enter a thought...';

  // Make it auto-expand
  textArea.addEventListener('input', autoResize);

  // Distress rating remains the same
  const ratingInput = document.createElement('input');
  ratingInput.type = 'number';
  ratingInput.min = '1';
  ratingInput.max = '10';
  ratingInput.step = '1';
  ratingInput.className = 'thought-rating';
  ratingInput.placeholder = '1-10';
  ratingInput.oninput = highlightMostDistressingThought;

  // Append them
  row.appendChild(textArea);
  row.appendChild(ratingInput);
  container.appendChild(row);

  // Immediately size the new textarea
  autoResize({ target: textArea });
}
  
  // Highlight the row(s) with the highest rating in red
  function highlightMostDistressingThought() {
    const rows = document.querySelectorAll('#thoughtContainer .thought-row');
    let maxRating = 0;
  
    // find max
    rows.forEach(r => {
      const val = parseInt(r.querySelector('.thought-rating').value) || 0;
      if (val > maxRating) {
        maxRating = val;
      }
    });
  
    // reset
    rows.forEach(r => {
      r.style.border = 'none';
      r.style.backgroundColor = '';
      const val = parseInt(r.querySelector('.thought-rating').value) || 0;
      if (val === maxRating && maxRating > 0) {
        r.style.border = '2px solid red';
        r.style.backgroundColor = '#3b1c1c';
      }
    });
  }
  
  // Collect them for Step 3 in the final email
  function getAllThoughts() {
  const rows = document.querySelectorAll('#thoughtContainer .thought-row');
  const data = [];
  rows.forEach(r => {
    // It's still .thought-text
    const thoughtValue = r.querySelector('.thought-text').value.trim();
    const ratingValue = r.querySelector('.thought-rating').value.trim();
    if (thoughtValue) {
      data.push({ thought: thoughtValue, distress: ratingValue });
    }
  });
  return data;
}

  
  /* --------------------------
     Evidence FOR logic
  -------------------------- */
  function addEvidenceForRow() {
  const container = document.getElementById('evidenceForContainer');
  const row = document.createElement('div');
  row.className = 'evidence-row';

  // Create a TEXTAREA with both classes:
  const textArea = document.createElement('textarea');
  textArea.className = 'evidence-text evidence-textarea';
  textArea.placeholder = 'Evidence FOR...';

  // Attach the autoResize function on each input event:
  textArea.addEventListener('input', autoResize);

  // Keep your rating input the same:
  const ratingInput = document.createElement('input');
  ratingInput.type = 'number';
  ratingInput.min = '1';
  ratingInput.max = '10';
  ratingInput.step = '1';
  ratingInput.className = 'evidence-rating';
  ratingInput.placeholder = '1-10';
  ratingInput.oninput = highlightHighestFor;

  // Append both elements to row
  row.appendChild(textArea);
  row.appendChild(ratingInput);

  // Append row to container
  container.appendChild(row);

  // Immediately call autoResize() so the textarea starts at proper height
  autoResize({ target: textArea });
}


  
  function highlightHighestFor() {
    const rows = document.querySelectorAll('#evidenceForContainer .evidence-row');
    let maxVal = 0;
    // find max
    rows.forEach(r => {
      const val = parseInt(r.querySelector('.evidence-rating').value) || 0;
      if (val > maxVal) maxVal = val;
    });
    // reset
    rows.forEach(r => {
      r.style.border = 'none';
      r.style.backgroundColor = '';
      const val = parseInt(r.querySelector('.evidence-rating').value) || 0;
      if (val === maxVal && maxVal > 0) {
        r.style.border = '2px solid #007bff';
        r.style.backgroundColor = 'rgba(0,123,255,0.2)';
      }
    });
  }

  function autoResize(e) {
    const textArea = e.target;
    // Reset the height to auto so scrollHeight is correct
    textArea.style.height = 'auto';
    // Set it to the scroll height, so it grows to fit
    textArea.style.height = textArea.scrollHeight + 'px';
  }
  
  function getAllEvidenceFor() {
  const rows = document.querySelectorAll('#evidenceForContainer .evidence-row');
  const data = [];
  rows.forEach(r => {
    // STILL references ".evidence-text" (this is why we gave our <textarea> that class too!)
    const textVal = r.querySelector('.evidence-text').value.trim();
    const ratingVal = r.querySelector('.evidence-rating').value.trim();
    if (textVal) {
      data.push({ text: textVal, rating: ratingVal });
    }
  });
  return data;
}
  
  /* --------------------------
     Evidence AGAINST logic
  -------------------------- */
  function addEvidenceAgainstRow() {
  const container = document.getElementById('evidenceAgainstContainer');
  const row = document.createElement('div');
  row.className = 'evidence-row';

  const textArea = document.createElement('textarea');
  textArea.className = 'evidence-text evidence-textarea';
  textArea.placeholder = 'Evidence AGAINST...';

  textArea.addEventListener('input', autoResize);

  const ratingInput = document.createElement('input');
  ratingInput.type = 'number';
  ratingInput.min = '1';
  ratingInput.max = '10';
  ratingInput.step = '1';
  ratingInput.className = 'evidence-rating';
  ratingInput.placeholder = '1-10';
  ratingInput.oninput = highlightHighestAgainst;

  row.appendChild(textArea);
  row.appendChild(ratingInput);
  container.appendChild(row);

  autoResize({ target: textArea });
}
  
  function highlightHighestAgainst() {
    const rows = document.querySelectorAll('#evidenceAgainstContainer .evidence-row');
    let maxVal = 0;
    // find max
    rows.forEach(r => {
      const val = parseInt(r.querySelector('.evidence-rating').value) || 0;
      if (val > maxVal) maxVal = val;
    });
    // reset
    rows.forEach(r => {
      r.style.border = 'none';
      r.style.backgroundColor = '';
      const val = parseInt(r.querySelector('.evidence-rating').value) || 0;
      if (val === maxVal && maxVal > 0) {
        r.style.border = '2px solid #cc33cc';
        r.style.backgroundColor = 'rgba(204,51,204,0.2)';
      }
    });
  }
  
  function getAllEvidenceAgainst() {
    const rows = document.querySelectorAll('#evidenceAgainstContainer .evidence-row');
    const data = [];
    rows.forEach(r => {
      const textVal = r.querySelector('.evidence-text').value.trim();
      const ratingVal = r.querySelector('.evidence-rating').value.trim();
      if (textVal) {
        data.push({ text: textVal, rating: ratingVal });
      }
    });
    return data;
  }
  
  /* --------------------------
     Build final summary + send email
  -------------------------- */
  function buildSummary() {
    // STEP 1
    const situation = document.getElementById("situationInput").value.trim();
  
    // STEP 2
    const feelingData = [];
    // Feeling #1
    const broad1 = feelingSelect1.value || "(none)";
    const sub1 = subFeelingSelect1.value || "(none)";
    if (broad1 !== "(none)") {
      feelingData.push(`Feeling #1: ${broad1}, Sub-Feeling: ${sub1}`);
    }
    // Feeling #2
    if (!document.getElementById("feelingBlock2").classList.contains("hidden")) {
      const broad2 = feelingSelect2.value || "(none)";
      const sub2 = subFeelingSelect2.value || "(none)";
      if (broad2 !== "(none)") {
        feelingData.push(`Feeling #2: ${broad2}, Sub-Feeling: ${sub2}`);
      }
    }
    // Feeling #3
    if (!document.getElementById("feelingBlock3").classList.contains("hidden")) {
      const broad3 = feelingSelect3.value || "(none)";
      const sub3 = subFeelingSelect3.value || "(none)";
      if (broad3 !== "(none)") {
        feelingData.push(`Feeling #3: ${broad3}, Sub-Feeling: ${sub3}`);
      }
    }
  
    // STEP 3 (multiple thoughts)
    const thoughtsData = getAllThoughts();
    let step3Text = "(No thoughts entered)";
    if (thoughtsData.length > 0) {
      step3Text = thoughtsData
        .map((obj, idx) => `Thought #${idx+1}: ${obj.thought} (Distress: ${obj.distress})`)
        .join("\n");
    }
  
    // STEP 4
    // Distortions chosen
    const distortionsSelected = getSelectedDistortions();
    const distortionsString = distortionsSelected.length 
      ? "Problematic Styles Chosen:\n" + distortionsSelected.join(", ")
      : "(No problematic thinking styles selected)";
  
    // Gather Evidence FOR
    const forData = getAllEvidenceFor();
    let evidenceForText = "(No Evidence FOR added)";
    if (forData.length > 0) {
      evidenceForText = forData
        .map((obj, idx) => `FOR #${idx+1}: ${obj.text} (Severity: ${obj.rating})`)
        .join("\n");
    }
  
    // Gather Evidence AGAINST
    const againstData = getAllEvidenceAgainst();
    let evidenceAgainstText = "(No Evidence AGAINST added)";
    if (againstData.length > 0) {
      evidenceAgainstText = againstData
        .map((obj, idx) => `AGAINST #${idx+1}: ${obj.text} (Severity: ${obj.rating})`)
        .join("\n");
    }
  
    // STEP 5
    const accuracyRadio = document.querySelector('input[name="accuracy"]:checked');
    const accuracy = accuracyRadio ? accuracyRadio.value : "(none)";
    const newThought = document.getElementById("newThought").value.trim();
  
    // Build final text
    return `
  **STEP 1: THE SITUATION**
  =====================
  ${situation}
  
  **STEP 2: THE FEELING(S)**
  =====================
  ${feelingData.length > 0 ? feelingData.join("\n") : "(No feelings selected)"}
  
  **STEP 3: THE THOUGHT(S)**
  =====================
  ${step3Text}
  
  **STEP 4: EVALUATE THE THOUGHT**
  =====================
  ${distortionsString}
  
  EVIDENCE FOR:
  ${evidenceForText}
  
  EVIDENCE AGAINST:
  ${evidenceAgainstText}
  
  **STEP 5: MAKE A DECISION**
  =====================
  Thought is: ${accuracy}
  New Thought / Action Plan:
  ${newThought}
    `.trim();
  }
  
  function sendEmail() {
  const summary = buildSummary();
  const safeBody = encodeURIComponent(summary).replace(/%0A/g, '%0D%0A');

  const userEmail = document.getElementById("userEmail").value.trim();
  if (!userEmail) {
    alert("Please enter your email address first.");
    return;
  }

  const customTitle = document.getElementById("emailTitle").value.trim();
  let finalSubject = "CBT";
  if (customTitle) {
    finalSubject += ` - ${customTitle}`;
  }

  const mailtoLink = `mailto:${encodeURIComponent(userEmail)}?subject=${encodeURIComponent(finalSubject)}&body=${safeBody}`;

  // Open the mailto link in a new tab
  window.open(mailtoLink, '_blank');
}

  </script>
  
</body>
</html>